<!DOCTYPE html>
<html lang="ja" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ã‚¹ãƒãƒ›Webå·¥æˆ¿</title>
<style>
/* =========================================
   Global Reset & UI Variables
   ========================================= */
:root {
    --header-h: 60px;
    --footer-h: 40px;
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
    --shadow-float: 0 10px 25px -5px rgba(0,0,0,0.15);

    --ui-primary: #020562;
    --ui-accent: #22AEC9;
    --ui-bg: #F8FAFC;
    --ui-surface: #FFFFFF;
    --ui-text: #334155;
    --ui-text-muted: #64748B;
    --ui-border: #E2E8F0;
    --ui-danger: #EF4444;
    --ui-success: #10B981;
    --ui-header-bg: #FFFFFF;
}

[data-theme="dark"] {
    --ui-primary: #818cf8;
    --ui-accent: #38bdf8;
    --ui-bg: #0f172a;
    --ui-surface: #1e293b;
    --ui-text: #f1f5f9;
    --ui-text-muted: #94a3b8;
    --ui-border: #334155;
    --ui-header-bg: #1e293b;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    margin: 0; padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: var(--ui-bg);
    color: var(--ui-text);
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* =========================================
   App Header
   ========================================= */
.app-header {
    height: var(--header-h);
    background: var(--ui-header-bg);
    border-bottom: 1px solid var(--ui-border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    z-index: 50;
    flex-shrink: 0;
}

.app-logo {
    display: flex; flex-direction: column; justify-content: center;
    gap: 2px;
    font-weight: 800; font-size: 1rem;
    color: var(--ui-text);
}
.app-logo span.sub { font-size:0.65rem; font-weight:normal; opacity:0.8; }

/* View Switcher (åˆ¶ä½œ/å®Œæˆ) */
.view-switcher {
    display: flex; background: var(--ui-bg);
    padding: 4px; border-radius: 20px;
    border: 1px solid var(--ui-border);
}
.switch-btn {
    padding: 6px 16px; border-radius: 16px; border: none;
    background: transparent; color: var(--ui-text-muted);
    font-weight: 600; font-size: 0.85rem; cursor: pointer;
    transition: all 0.2s;
}
.switch-btn.active {
    background: var(--ui-surface); color: var(--ui-primary);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.app-actions { display: flex; gap: 8px; }

/* =========================================
   Main Layout
   ========================================= */
.app-main {
    flex: 1;
    display: grid;
    grid-template-columns: 420px 1fr; /* PC Default */
    overflow: hidden;
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* --- Presentation Mode (å®Œæˆç”»é¢) --- */
.app-main.view-preview {
    grid-template-columns: 0 1fr;
}
.app-main.view-preview .editor-panel {
    transform: translateX(-420px);
}
.app-main.view-preview .preview-panel {
    display: flex; width: 100%; height: 100%;
}
.app-main.view-preview .preview-toolbar { display: none; }
.app-main.view-preview .preview-canvas { padding: 0; background: #fff; }
.app-main.view-preview .preview-frame-wrapper { width: 100% !important; height: 100% !important; border:none; border-radius: 0; box-shadow: none; }

/* Desktop Preview (Right side in editor mode) */
.editor-panel {
    background: var(--ui-surface);
    border-right: 1px solid var(--ui-border);
    display: flex; flex-direction: column;
    overflow-y: auto;
    position: relative;
    z-index: 10;
    transition: transform 0.3s;
}
.preview-panel {
    background: #1e293b;
    display: flex; flex-direction: column;
    position: relative; overflow: hidden;
}

/* Step UI */
.step-container { padding: 24px; padding-bottom: 100px; display: flex; flex-direction: column; gap: 32px; }
.step-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
.step-num { background: var(--ui-accent); color: #fff; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.85rem; }
.step-title { font-weight: 700; font-size: 1.05rem; color: var(--ui-text); }

/* Compact Inputs */
.compact-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
.input-row { display: flex; flex-direction: column; gap: 6px; }
.label-sm { font-size: 0.8rem; font-weight: 600; color: var(--ui-text-muted); }
.input-sm { padding: 10px; border: 1px solid var(--ui-border); border-radius: var(--radius-sm); font-size: 0.95rem; background: var(--ui-bg); color: var(--ui-text); }

/* Photo Cards */
.photo-deck { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.photo-card { background: var(--ui-bg); border: 2px dashed var(--ui-border); border-radius: var(--radius-md); position: relative; cursor: pointer; overflow: hidden; aspect-ratio: 4/3; transition: all 0.2s; }
.photo-card.hero { grid-column: 1 / -1; aspect-ratio: 16/9; border-color: var(--ui-accent); background: rgba(34, 174, 201, 0.05); }
.photo-card.has-image { border-style: solid; border-color: transparent; }
.photo-placeholder { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--ui-text-muted); pointer-events: none; text-align: center; padding: 10px; }
.photo-placeholder svg { width: 32px; height: 32px; margin-bottom: 8px; opacity: 0.5; }
.photo-label { font-size: 0.8rem; font-weight: 600; margin-bottom: 2px;}
.photo-preview { width: 100%; height: 100%; object-fit: cover; display: none; }
.photo-card.has-image .photo-preview { display: block; }
.photo-card.has-image .photo-placeholder { display: none; }
.btn-photo-clear { position: absolute; top: 6px; right: 6px; width: 24px; height: 24px; border-radius: 50%; background: rgba(0,0,0,0.6); color: #fff; border: none; display: none; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; }
.photo-card.has-image:hover .btn-photo-clear { display: flex; }

/* Toolbar */
.preview-toolbar { height: 50px; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; gap: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
.device-btn { background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; }
.device-btn.active { background: var(--ui-accent); border-color: var(--ui-accent); color: #fff; }

.preview-canvas { flex: 1; display: flex; justify-content: center; align-items: center; overflow: auto; padding: 40px; }
.preview-frame-wrapper { background: #fff; box-shadow: 0 20px 50px rgba(0,0,0,0.5); transition: all 0.3s; width: 100%; height: 100%; }
.preview-frame-wrapper.mode-pc { max-width: 1200px; }
.preview-frame-wrapper.mode-mobile { width: 375px; max-height: 750px; border-radius: 24px; border: 10px solid #333; }
iframe { width: 100%; height: 100%; border: none; }

/* Floating Save Button in Demo Mode */
.demo-save-container {
    position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
    display: none; z-index: 100;
}
.app-main.view-preview .demo-save-container { display: block; }
.btn-save-demo { 
    background: var(--ui-success); color: #fff; border: none;
    padding: 16px 32px; border-radius: 50px; font-weight: bold; font-size: 1rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4); cursor: pointer;
    display: flex; align-items: center; gap: 10px; transition: transform 0.2s;
}
.btn-save-demo:active { transform: translateX(-50%) scale(0.95); }

/* Color Pills */
.color-pills { display: flex; gap: 8px; }
.color-pill { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; position: relative; }
.color-pill.active { border-color: var(--ui-text); transform: scale(1.1); }
.color-pill::after { content:''; position:absolute; inset:2px; border-radius:50%; background: var(--bg); }

/* General UI */
.btn { padding: 8px 16px; border-radius: var(--radius-sm); font-weight: 600; cursor: pointer; border: 1px solid transparent; display: inline-flex; align-items: center; gap: 6px; }
.btn-primary { background: var(--ui-primary); color: #fff; }
.btn-ghost { background: transparent; color: var(--ui-text); border-color: var(--ui-border); }
.btn-icon { padding: 8px; border-radius: 50%; color: var(--ui-text); background: transparent; border: none; cursor: pointer; position: relative; }
.toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #1e293b; color: #fff; padding: 10px 24px; border-radius: 30px; font-size: 0.9rem; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 300; }
.toast.active { opacity: 1; }

/* Modals */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 200; display: none; align-items: center; justify-content: center; }
.modal-overlay.active { display: flex; }
.modal-box { background: var(--ui-surface); width: 90%; max-width: 400px; border-radius: var(--radius-lg); box-shadow: var(--shadow-float); overflow: hidden; }
.modal-header { padding: 16px 20px; border-bottom: 1px solid var(--ui-border); font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
.modal-body { padding: 20px; }

@media (max-width: 768px) {
    .app-main { grid-template-columns: 1fr; }
    .app-logo { display:none; }
}
</style>
</head>
<body>

<header class="app-header">
    <div class="app-logo">
        <span>ğŸ“± ã‚¹ãƒãƒ›Webå·¥æˆ¿</span>
        <span class="sub">ç§’é€Ÿãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</span>
    </div>
    
    <div class="view-switcher">
        <button class="switch-btn active" id="btn-editor-mode" data-view="editor">ğŸ› ï¸ åˆ¶ä½œ</button>
        <button class="switch-btn" id="btn-preview-mode" data-view="preview">ğŸ“± å®Œæˆ</button>
    </div>

    <div class="app-actions">
        <button class="btn btn-icon" id="btn-settings" title="è¨­å®š">âš™ï¸<div class="badge-dot" id="badge-settings"></div></button>
        <button class="btn btn-primary" id="btn-header-save">ğŸ’¾ ä¿å­˜</button>
    </div>
</header>

<main class="app-main view-editor" id="app-main">
    <!--åˆ¶ä½œç”»é¢ (EDITOR) -->
    <div class="editor-panel">
        <div class="step-container">
            <div class="step-section">
                <div class="step-header"><div class="step-num">1</div><div class="step-title">åŸºæœ¬ã®è¨­å®š</div></div>
                <div class="compact-grid">
                    <div class="input-row">
                        <label class="label-sm">æ¥­ç¨®ï¼ˆæ–‡ç« ãŒå¤‰ã‚ã‚Šã¾ã™ï¼‰</label>
                        <select id="sel-industry" class="input-sm">
                            <option value="manufacturing">è£½é€ æ¥­</option>
                            <option value="wholesale">å¸æ¥­</option>
                            <option value="insurance">ä¿é™ºä»£ç†åº—</option>
                            <option value="renovation">å†…è£…ãƒ»ãƒªãƒ•ã‚©ãƒ¼ãƒ </option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label class="label-sm">ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚«ãƒ©ãƒ¼</label>
                        <div class="color-pills" id="color-pills"></div>
                    </div>
                </div>
            </div>

            <div class="step-section">
                <div class="step-header"><div class="step-num">2</div><div class="step-title">JPGå†™çœŸã‚’ã‚»ãƒƒãƒˆ</div></div>
                <p style="font-size:0.75rem; color:var(--ui-text-muted); margin-bottom:12px;">æ ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã‚¹ãƒãƒ›ã®å†™çœŸã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                <div class="photo-deck">
                    <div class="photo-card hero" id="card-hero" data-target="hero">
                        <img src="" class="photo-preview" id="img-hero">
                        <div class="photo-placeholder"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg><span class="photo-label">ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç”»é¢</span></div>
                        <button class="btn-photo-clear" data-target="hero">âœ•</button>
                    </div>
                    <div class="photo-card" id="card-p1" data-target="p1">
                        <img src="" class="photo-preview" id="img-p1">
                        <div class="photo-placeholder"><span class="photo-label">ç”»é¢ â‘ </span></div>
                        <button class="btn-photo-clear" data-target="p1">âœ•</button>
                    </div>
                    <div class="photo-card" id="card-p2" data-target="p2">
                        <img src="" class="photo-preview" id="img-p2">
                        <div class="photo-placeholder"><span class="photo-label">ç”»é¢ â‘¡</span></div>
                        <button class="btn-photo-clear" data-target="p2">âœ•</button>
                    </div>
                    <div class="photo-card" id="card-p3" data-target="p3">
                        <img src="" class="photo-preview" id="img-p3">
                        <div class="photo-placeholder"><span class="photo-label">ç”»é¢ â‘¢</span></div>
                        <button class="btn-photo-clear" data-target="p3">âœ•</button>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="btn-jump-preview" style="padding:16px; border-radius:var(--radius-md);">ğŸ“± å®Œæˆã—ãŸã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</button>
        </div>
    </div>

    <!-- å®Œæˆãƒ‡ãƒ¢ç”»é¢ (PREVIEW) -->
    <div class="preview-panel">
        <div class="preview-toolbar">
            <button class="device-btn active" data-mode="pc">ãƒ‘ã‚½ã‚³ãƒ³è¡¨ç¤º</button>
            <button class="device-btn" data-mode="mobile">ã‚¹ãƒãƒ›è¡¨ç¤º</button>
        </div>
        <div class="preview-canvas">
            <div class="preview-frame-wrapper mode-pc" id="preview-wrapper">
                <iframe id="preview-frame"></iframe>
            </div>
        </div>
        
        <!-- å®Œæˆç”»é¢ã ã‘ã§è¦‹ãˆã‚‹ã€Œãƒ‡ãƒ¢ã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ -->
        <div class="demo-save-container">
            <button class="btn-save-demo" id="btn-save-demo">
                ğŸ’¾ ä½œæˆã—ãŸãƒ‡ãƒ¢ã‚’ä¿å­˜ã™ã‚‹
            </button>
        </div>
    </div>

    <input type="file" id="file-input" accept="image/*" style="display:none">
</main>

<!-- MODALS -->
<div class="modal-overlay" id="modal-settings">
    <div class="modal-box">
        <div class="modal-header"><span>âš™ï¸ åŸºæœ¬æƒ…å ±</span><button class="btn-icon modal-close">âœ•</button></div>
        <div class="modal-body">
            <div class="compact-grid">
                <div class="input-row"><label class="label-sm">ä¼šç¤¾åãƒ»å±‹å·</label><input type="text" id="inp-company" class="input-sm" placeholder="å‰ç”°ç²¾å·¥æ ªå¼ä¼šç¤¾"></div>
                <div class="input-row"><label class="label-sm">ä½æ‰€</label><input type="text" id="inp-address" class="input-sm"></div>
                <hr style="border:none; border-top:1px dashed var(--ui-border); margin:10px 0;">
                <button id="btn-load-demo" class="btn btn-ghost" style="width:100%">ğŸ­ ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€</button>
            </div>
        </div>
        <div style="padding:16px; display:flex; justify-content:flex-end;"><button class="btn btn-primary modal-close">OK</button></div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Helpers (Define FIRST to avoid ReferenceErrors) ---
    const getEl = (id) => document.getElementById(id);
    const bindEvent = (id, event, handler) => {
        const el = getEl(id);
        if (el) el.addEventListener(event, handler);
    };

    // UI Elements References
    const appMain = getEl('app-main');
    const previewFrame = getEl('preview-frame');
    const fileInput = getEl('file-input');
    const toast = getEl('toast');
    const modalSettings = getEl('modal-settings');

    const state = {
        industry: 'manufacturing',
        themeColor: '#020562',
        company: 'ï¼ˆä¼šç¤¾åã‚’å…¥åŠ›ï¼‰',
        catch: 'æ—¥æœ¬ã®ã‚‚ã®ã¥ãã‚Šã‚’ã€\nä¸–ç•Œã¸å±Šã‘ã‚‹æŠ€è¡“åŠ›ã€‚',
        points: [
            {t: 'çŸ­ç´æœŸå¯¾å¿œ', d: '24æ™‚é–“ç¨¼åƒä½“åˆ¶ã§æ€¥ãªã”ä¾é ¼ã«ã‚‚å¯¾å¿œã€‚'},
            {t: 'ãƒŸã‚¯ãƒ­ãƒ³å˜ä½ã®ç²¾åº¦', d: 'æœ€æ–°è¨­å‚™ã¨ç†Ÿç·´ã®æŠ€ã§é«˜ç²¾åº¦åŠ å·¥ã‚’å®Ÿç¾ã€‚'},
            {t: 'è©¦ä½œã‹ã‚‰é‡ç”£ã¾ã§', d: '1å€‹ã®è©¦ä½œã‹ã‚‰é‡ç”£ã¾ã§ä¸€è²«å¯¾å¿œå¯èƒ½ã§ã™ã€‚'}
        ],
        images: { hero: null, p1: null, p2: null, p3: null },
        details: { address: 'å¤§é˜ªåºœæ±å¤§é˜ªå¸‚' }
    };

    let activeImgTarget = null;

    // --- Core Logic ---

    function generateSiteHtml() {
        const c = state.themeColor;
        const heroBg = state.images.hero 
            ? `background-image: linear-gradient(rgba(0,0,0,0.3),rgba(0,0,0,0.3)), url(${state.images.hero});`
            : `background: linear-gradient(135deg, ${c}, #0f172a);`;

        const cardsHtml = state.points.map((p, i) => {
            const imgUrl = state.images[`p${i+1}`] || '';
            const imgTag = imgUrl 
                ? `<div style="height:220px; background:url(${imgUrl}) center/cover;"></div>`
                : `<div style="height:220px; background:#f3f4f6; display:flex; align-items:center; justify-content:center; color:#94a3b8;">ã‚¤ãƒ¡ãƒ¼ã‚¸ãªã—</div>`;
            return `
            <div class="card">
                ${imgTag}
                <div style="padding:24px;">
                    <h3 style="font-size:1.25rem; margin-bottom:12px; color:${c};">${p.t}</h3>
                    <p style="font-size:0.95rem; line-height:1.7; opacity:0.8;">${p.d}</p>
                </div>
            </div>`;
        }).join('');

        return `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${state.company}</title>
    <style>
        body { margin:0; font-family: sans-serif; color:#1e293b; background:#f8fafc; line-height:1.6; }
        header { background:#fff; padding:15px 5%; display:flex; justify-content:space-between; align-items:center; box-shadow:0 1px 3px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100; }
        .logo { font-weight:800; font-size:1.2rem; color:${c}; }
        .hero { height:60vh; min-height:400px; display:flex; align-items:center; justify-content:center; text-align:center; color:#fff; background-size:cover; background-position:center; ${heroBg} }
        .hero h1 { font-size: clamp(1.8rem, 5vw, 2.8rem); white-space:pre-wrap; text-shadow: 0 4px 15px rgba(0,0,0,0.5); padding:20px; }
        section { padding:80px 5%; max-width:1200px; margin:0 auto; }
        h2 { text-align:center; font-size:1.8rem; margin-bottom:50px; position:relative; }
        h2::after { content:''; display:block; width:50px; height:4px; background:${c}; margin:15px auto; }
        .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(320px, 1fr)); gap:30px; }
        .card { background:#fff; border-radius:16px; overflow:hidden; box-shadow:0 4px 6px rgba(0,0,0,0.05); }
        .footer { background:#0f172a; color:#fff; text-align:center; padding:60px 20px; }
    </style>
</head>
<body>
    <header><div class="logo">${state.company}</div></header>
    <div class="hero"><h1>${state.catch}</h1></div>
    <section>
        <h2>é¸ã°ã‚Œã‚‹ç†ç”±</h2>
        <div class="grid">${cardsHtml}</div>
    </section>
    <div class="footer">
        <p style="font-weight:bold; font-size:1.2rem; margin-bottom:10px;">${state.company}</p>
        <p style="opacity:0.7; font-size:0.9rem;">${state.details.address}</p>
        <p style="margin-top:30px; opacity:0.5; font-size:0.8rem;">&copy; ${state.company}</p>
    </div>
</body>
</html>`;
    }

    function render() {
        if(previewFrame) previewFrame.srcdoc = generateSiteHtml();
        // Sync Inputs
        if(getEl('inp-company')) getEl('inp-company').value = state.company;
        if(getEl('inp-address')) getEl('inp-address').value = state.details.address;
        // Sync Photos
        ['hero', 'p1', 'p2', 'p3'].forEach(k => {
            const imgTag = getEl(`img-${k}`);
            const parent = imgTag ? imgTag.parentElement : null;
            if(imgTag && parent) {
                if(state.images[k]) {
                    imgTag.src = state.images[k];
                    parent.classList.add('has-image');
                } else {
                    parent.classList.remove('has-image');
                }
            }
        });
    }

    function switchView(view) {
        document.querySelectorAll('.switch-btn').forEach(b => b.classList.toggle('active', b.dataset.view === view));
        if(view === 'preview') {
            appMain.className = 'app-main view-preview';
        } else {
            appMain.className = 'app-main view-editor';
        }
        render();
    }

    function download() {
        const content = generateSiteHtml();
        const blob = new Blob([content], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = (state.company || 'website') + '.html';
        a.click();
        showInfo('Webã‚µã‚¤ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
    }

    function showInfo(msg) {
        if(!toast) return;
        toast.innerText = msg;
        toast.classList.add('active');
        setTimeout(() => toast.classList.remove('active'), 3000);
    }

    // --- Event Listeners ---

    bindEvent('btn-editor-mode', 'click', () => switchView('editor'));
    bindEvent('btn-preview-mode', 'click', () => switchView('preview'));
    bindEvent('btn-jump-preview', 'click', () => switchView('preview'));
    
    bindEvent('btn-header-save', 'click', download);
    bindEvent('btn-save-demo', 'click', download);

    bindEvent('btn-settings', 'click', () => modalSettings.classList.add('active'));
    
    document.querySelectorAll('.modal-close').forEach(b => {
        b.onclick = () => modalSettings.classList.remove('active');
    });

    bindEvent('inp-company', 'input', (e) => { state.company = e.target.value; render(); });
    bindEvent('inp-address', 'input', (e) => { state.details.address = e.target.value; render(); });
    bindEvent('sel-industry', 'change', (e) => {
        state.industry = e.target.value;
        render();
    });

    bindEvent('btn-load-demo', 'click', () => {
        state.company = "å‰ç”°ç²¾å·¥æ ªå¼ä¼šç¤¾";
        state.details.address = "å¤§é˜ªåºœæ±å¤§é˜ªå¸‚";
        render();
        modalSettings.classList.remove('active');
        showInfo('ãƒ‡ãƒ¢æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
    });

    document.querySelectorAll('.photo-card').forEach(card => {
        card.onclick = (e) => {
            if(e.target.classList.contains('btn-photo-clear')) return;
            activeImgTarget = card.dataset.target;
            fileInput.click();
        };
    });

    if(fileInput) {
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                state.images[activeImgTarget] = ev.target.result;
                render();
                showInfo('å†™çœŸã‚’åæ˜ ã—ã¾ã—ãŸ');
            };
            reader.readAsDataURL(file);
        };
    }

    document.querySelectorAll('.btn-photo-clear').forEach(btn => {
        btn.onclick = (e) => {
            e.stopPropagation();
            state.images[btn.parentElement.dataset.target] = null;
            render();
        };
    });

    // Theme Color Pills
    const colors_list = ['#020562', '#22AEC9', '#10B981', '#F59E0B', '#EC4899'];
    const pillContainer = getEl('color-pills');
    if(pillContainer) {
        colors_list.forEach(hex => {
            const d = document.createElement('div');
            d.className = 'color-pill';
            d.style.setProperty('--bg', hex);
            if(state.themeColor === hex) d.classList.add('active');
            d.onclick = () => {
                state.themeColor = hex;
                document.querySelectorAll('.color-pill').forEach(p => p.classList.remove('active'));
                d.classList.add('active');
                render();
            };
            pillContainer.appendChild(d);
        });
    }

    // Device Switching
    document.querySelectorAll('.device-btn').forEach(btn => {
        btn.onclick = () => {
            document.querySelectorAll('.device-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            getEl('preview-wrapper').className = 'preview-frame-wrapper mode-' + btn.dataset.mode;
        };
    });

    // Start
    render();
});
</script>
</body>
</html>